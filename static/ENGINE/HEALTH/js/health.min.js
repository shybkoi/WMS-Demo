$(document).ready(function(){HealthPlot();HealthRefresh();AorderStatTasksDelete()});function HealthPlot(){var acolor=["#00ff00","#ff0000"];var data=[];var colordata=[];var series=slices.length;for(var i=0;i<slices.length;i++){data[i]={label:slicelabels[i],data:1};colordata[i]=acolor[slicedata[i]]}$.plot($("#graph"),data,{colors:colordata,series:{pie:{show:true,radius:1,label:{show:true,radius:2/3,formatter:function(label,slice){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+slice.color+';"><a href="#" class="aSlicePie">'+label+'</a></div>'},background:{opacity:0.5,color:'#fff'}},}},grid:{clickable:false,}});$('a.aSlicePie').unbind('click').click(function(){var aclass_index=$(this).closest('span.pieLabel').attr('id').split('pieLabel')[1];aclass=(slices[parseInt(aclass_index)]);$.getJSON('index',{'f':'jsontmpl','refresh_block':aclass},function(data){$('#graph-detail').html(data.data.TMPL);HealthRefresh();AorderStatTasksDelete()});return false})}function AorderStatTasksDelete(){$('#CNT_AORDERSTAT_TASKS_ON').unbind('click').click(function(){if(can_delete_aorderstat=='1')if(confirm('¬ы действительно хотите удалить статистику?')){$.getJSON('deleteaorderstat',function(data){if(data.ext_data.res=='1'){$('#CNT_AORDERSTAT_TASKS_ON').text(0);$('#CNT_AORDERSTAT_TASKS_ON').attr('class','Count HealthGood');slicedata[2]=0;HealthPlot()}else alert(data.ext_data.errMes)})}return false})}function HealthRefresh(){$('a.refresh').unbind('click').click(function(){var aclass=$(this).closest('div.row').attr('class').split(' ')[1];$.getJSON('index',{'f':'json','refresh_block':aclass},function(data){for(i in data.data){$('#'+i).text(data.data[i]);if(i.indexOf('_TASKS_ON')!=-1)$('#'+i).attr('class','Count Health'+(data.data[i]==0?'Good':'Bad'))}});return false})}